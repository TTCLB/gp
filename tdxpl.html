

<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="referrer" content="no-referrer"/>
<meta name="referrer" content="never"/>
<meta name="referrer" content="same-origin"/>
<meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">





    <!-- ================= Favicon ================== -->
    <!-- Standard -->
		<link rel="shortcut icon" href="/favicon.ico">
    <!-- Styles -->
           <link href="assets/css/lib/bootstrap.min.css" rel="stylesheet">
           <link href="assets/css/style.css" rel="stylesheet">
           <link href="assets/css/lib/themify-icons.css" rel="stylesheet">
           <title>偏离值计算</title>
    <script>
    </script>
</head>
<style>
body{background-color:#1C1D21;}
</style>
<body  onload="lsgc()"> 





                         <div class="card" >
                             <div class="card-title" id="tou" style="margin-bottom:-5%">
                                 </div>

                                <div class="card-body">
                                    <div class="input-sizes">
                                        <form class="form-horizontal fc-view" >
                                                  
                                   <div class="form-group" >


                                            <div class="row">
                                              <div class="col-lg-2"></div>
                                                <div class="col-lg-8">
                                                    <input id="wei" type="text" style="color:red" placeholder="偏离值(公告时间隔日开始计算三天偏离值)"  class="form-control" >
                                                    
                                                </div>
                                            </div>  
                                            <div class="row">
                                              <div class="col-lg-2"></div>
                                                <div class="col-lg-8">
                                                    <input id="wei1" type="text" style="color:red" placeholder="明天剩余空间大盘未计入【盘中不显示】"  class="form-control" >
                                                    
                                                </div>
                                            </div>                                              
                                           <div class="row">
                                              <div class="col-lg-2"></div>
                                                <div class="col-lg-8">
                                                    <select class="form-control" id="yidong"  >
																<option value="全部店铺">异动/停牌展示</option>
													</select>
                                                    
                                                </div>
                                            </div>  
                                           <div class="row">
                                              <div class="col-lg-2"></div>
                                                <div class="col-lg-8">
                                                    <select class="form-control" id="zt"  style="margin-bottom:-3%">
																
													</select>
                                                    
                                                </div>
                                            </div>                                              
                                   </div>

                                   

                                                    

                                            <div class="row"align="right">
                                              
                                    </div>
                                        
                                        </form>
                                    </div>
                                
                   

        </div>
    </div>
       <script src="assets/js/lib/jquery.min.js"></script>
    <script src="assets/laydate/laydate.js"></script>
    <script src="assets/layer_mobile/layer.js"></script>
    <script src="js/date.format.js"></script>
    <script src="js/gbk.js"></script>
   <script>
   document.onkeydown = keyListener;
function keyListener(e) {
// 当按下回车键，执行我们的代码
    if (e.keyCode == 13) {
SubInfo();
    }
}
function checkTime(i){
	if (i<10) 
  {i="0" + i}
  
  return i
 
};
function timeFormat(date) {
    if (!date || typeof(date) === "string") {
        this.error("参数异常，请检查...");
    }
    var y = date.getFullYear(); //年
    var m = checkTime(date.getMonth() + 1); //月
    var d = checkTime(date.getDate()); //日

    return y + "-" + m + "-" + d;
}

function charu(soure, start, newStr){   
   return soure.slice(0, start) + newStr + soure.slice(start);
}
$(function(){
    laydate.render({
  elem: '#EndTime'
  ,type: 'datetime'
  ,value: new Date() 
  ,zIndex: 99999999
  ,format: 'yyyyMMdd'
});

 laydate.render({
  elem: '#StartTime'
  ,type: 'datetime'
  ,value: new Date() 
  ,zIndex: 99999999
  ,format: 'yyyyMMdd'
});

});



function encodeToGb2312(str){
    var strOut="";
    for(var i = 0; i < str.length; i++){
        var c = str.charAt(i); 
        var code = str.charCodeAt(i);
        if(c==" ") strOut +="+";
        else if(code >= 19968 && code <= 40869){
            index = code - 19968;
            strOut += "%" + z.substr(index*4,2) + "%" + z.substr(index*4+2,2);
        }
        else{
            strOut += "%" + str.charCodeAt(i).toString(16);
        }
    }
    return strOut;
}

function lsgc(){
var dz=location.search;
console.log(dz)
 if (dz.indexOf("?") != -1) {

  var zfc = dz.substr(1);

  zfc = zfc.split("&");
  
  zfc=zfc[0].slice(6,12);
 }


var dyyd="";
var youguan="";
var xingqi=new Date().getDay();


     daima="cn_"+zfc;
     mama=zfc;



console.log(daima)
 var pianli=$("#pianli").val();
 var zs="zs_000001";
 var zs1="sh000001";
 var nali="上证";
  console.log(pianli)
 if(pianli!=""){
     var tou = document.getElementById("tou");
    remove_md = tou.lastElementChild;
    if(remove_md!=null){
    tou.removeChild(remove_md);  
    }
    remove_md = tou.lastElementChild;
    if(remove_md!=null){
    tou.removeChild(remove_md);  
    }
 }

 if(daima.slice(3,5)=="00"){
   
     zs="zs_399106";
     zs1="sz399106";
     nali="深证"
 }
 var dzh=0;
 var zzh=0;
 var js=0;
 var stime=new Date();
 var etime=new Date();
 var bd=0;
 var jsbd=0;
 var pz=0;
 var qgg=0;
 var qzs=0;
 var qssj="2020-01-01";
 var qswz=2;

     for(var i=1;i<10;i++){
         var curTime = new Date().getTime();
         var startDate = curTime - (i * 3600 * 24 * 1000);
         var time = new Date(startDate);
          if(time.getDay() != 0 && time.getDay() != 6){
              js=js+1;
              stime=time.format('Ymd');
          }
          if (js==3){
              etime=new Date().format('Ymd');              
              break;
          }
     }


 $("#yidong").empty();
  $("#zt").empty();
var obj=document.getElementById('yidong');
var obj1=document.getElementById('zt');
obj.add(new Option("异动/停牌展示",0));



 
            $.ajax({
                type:"get",//请求服务器载入数据
               // async: false,
                url:"https://np-anotice-stock.eastmoney.com/api/security/ann?page_size=50&page_index=1&ann_type=A&client_source=web&stock_list="+mama+"&f_node=0&s_node=0&rt=jsonp",
                             dataType:'jsonp',//服务器返回json格式数据
                             jsonpCallback:'cb',
                             jsonp: 'cb',
                             crossDomain: true,
                             
                             //data:"{}",                         
                success:function(xin){
                    yd=0;

                    for(var c=0;c<xin.data.list.length;c++){
                         code=xin.data.list[c].art_code;
                         shijian=xin.data.list[c].display_time.split(" ");
                         shijian=shijian[0];
                       
                         neirong=xin.data.list[c].title;
                         if(neirong.indexOf("波动")!=-1 || neirong.indexOf("停牌")!=-1 || neirong.indexOf("关注函")!=-1){
                             yd=yd+1;
                             zzsj=charu(etime,4,"-");
                             zzsj=charu(zzsj,7,"-");
                             jjs=0;
                             for(var qwe=1;qwe<20;qwe++){//找出10天前是哪一个日期
                                 
                                  curTime1 = new Date(Date.parse(zzsj)).getTime();
                                  startDate1 = curTime1 - (qwe * 3600 * 24 * 1000);
                                  time1 = new Date(startDate1);
                                  if(time1.getDay() != 0 && time1.getDay() != 6){
                                      jjs=jjs+1;
                                  }
                                  if (jjs==9){
                                      
                                      break;
                                  }
                             }                             
                             
                             
                             zzsj=startDate1;
                             console.log(zzsj)
                             if(new Date(Date.parse(shijian))==zzsj&&neirong.indexOf("波动")!=-1&&neirong.indexOf("回")==-1){
                                 jsbd=jsbd+1;
                             }
                             ggsj=(Date.parse(shijian));
                             if(neirong.indexOf("波动")!=-1 && ggsj>=zzsj && neirong.indexOf("回")==-1){
                                 bd=bd+1;
                                 dyyd=shijian;
                                 if(bd==1){qssj=shijian}
                                 
                             }
                           
                             nr=xin.data.list[c].columns[0].column_name+"【"+shijian+"】";
                             obj.add(new Option(nr,yd));
                         }
                         
                         if (yd==10){
                              
                               break;
                           }
                     
                    }
                    
                    if(bd==1){
                      sd=new Date(qssj);
                      y=sd.getFullYear();
                      m=checkTime(sd.getMonth()+1);;
                      d=checkTime(sd.getDate()+1);
                      qssj=y+'-'+m+'-'+d;
                      console.log(qssj)
                    }
               $.ajax({
                type:"get",//请求服务器载入数据
                //async: false,
                url:"https://q.stock.sohu.com/hisHq?code="+daima+"&start="+stime+"&end="+etime+"&callback = callback&rt=jsonp",
                             dataType:'jsonp',//服务器返回json格式数据
                             jsonpCallback:'callback',
                             jsonp: 'callback',
                             crossDomain: true,
                             //data:"{}",
                             ContentType:'application/javascript',
                success:function(result){
                    console.log(daima)

                    if(result.length!=undefined){
                     console.log("最近的异动时间"+qssj)    
                    console.log("个股数据")
                    console.log(result)
                    console.log(result[0].hq.length)
                    if(result[0].hq.length==4) {pz=1}
                    kswz=result[0].hq.length;
                    if(result[0].hq.length==1){qgg=result[0].hq[0][2];dzh=result[0].hq[0][2];}
                    jinru=0;

                    zuihou=result[0].hq[0][2];
                    for(var a=0;a<kswz;a++){
                        console.log("前"+(a+1)+"收盘价:"+result[0].hq[a][2])
                        console.log(result[0].hq[a][0])
                        if(qssj<=result[0].hq[a][0]){
                       kaishi=result[0].hq[a][2];
                       jinru=1;
                       qswz=a;
                        //if(Number(zhi)>0){
                            dzh=(zuihou-kaishi)/kaishi*100
                            console.log(dzh)
                        //}
                        }
                        //}
                    }
                    console.log(qswz)
                    console.log(result[0].hq[qswz][0])
                     qgg=result[0].hq[qswz][2];
                    console.log(qgg)
                    //console.log(dzh)
                    ////////if(nali=="深证"){
                       ////// dzh=dzh.toFixed(5);
                        
                  ////  }
                    //else{
                   //     dzh=dzh.toFixed(7);
                   // }
               $.ajax({
                type:"get",//请求服务器载入数据
                //async: false,
                url:"https://q.stock.sohu.com/hisHq?code="+zs+"&start="+stime+"&end="+etime+"&callback = callback&rt=jsonp",
                             dataType:'jsonp',//服务器返回json格式数据
                             jsonpCallback:'callback',
                             jsonp: 'callback',
                             crossDomain: true,
                             data:"{}",                         
                success:function(res){
                    console.log(res)
                    kswz1=res[0].hq.length;
                    qzs=res[0].hq[qswz][2];
                    zzh=(res[0].hq[0][2]-res[0].hq[qswz][2])/res[0].hq[qswz][2]*100;
                    for(var b=0;b<kswz1;b++){
                        console.log("前"+(b+1)+"天指数收盘:"+res[0].hq[b][2])

                         //if(qssj>=res[0].hq[a][0]){
                              //  qzs=res[0].hq[0][2];
                                //console.log(qgg)
                               // zzh=0;
                           // }
                    }
                   //if(nali=="深证"){
                  //      zzh=zzh.toFixed(5);
                  //  }
                   // else{
                 //       zzh=zzh.toFixed(7);
                   // }
                    console.log(zzh)
                    esj=charu(etime,4,"-");
                    esj=charu(esj,7,"-");
                    for(var qw=1;qw<20;qw++){//找出10天前是哪一个日期
                        curTime2 = new Date(Date.parse(esj)).getTime();
                        startDate2 = curTime2 - (qw * 3600 * 24 * 1000);
                        time2 = new Date(startDate2);
                        if(time2.getDay() != 0 && time2.getDay() != 6){
                            if(new Date(Date.parse(dyyd))==startDate2)
                            {
                                youguan="（距前异动仅一天，今日无事）";
                            }
                            break;
                        }

                    }                    
                    
                    console.log("个股涨幅合:"+dzh)
                    console.log("指数涨幅合:"+zzh)
                    if(pz==1){
                         wz=2;
                        if(qswz<wz){wz=qswz}
                         ggs1=((result[0].hq[0][2]-result[0].hq[wz][2])/result[0].hq[wz][2]*100).toFixed(2);
                        zss1=((res[0].hq[0][2]-res[0].hq[wz][2])/res[0].hq[wz][2]*100).toFixed(2);
                        shengyu=20-(ggs1-zss1);
                      zz=(dzh-zzh).toFixed(2);
                      
                      if(zz==0.00){document.getElementById('wei').value="出了新的异动，偏离值明重新累计"}
                      else{
                          
                    document.getElementById('wei').value="偏离值:"+zz+youguan;
                    document.getElementById('wei1').value="明涨幅超【"+shengyu+"%】就异动（大盘涨幅未计入）";
                      }
                    }

                   $.ajax({
                    type:"get",//请求服务器载入数据
                    //async: false,
                    url:"https://qt.gtimg.cn/q=s_"+zs1+",s_"+zs1.slice(0,2)+mama,
                                 dataType:'html',//服务器返回json格式数据
                                 crossDomain: true,
                                 data:"{}",                         
                    success:function(zhishu){
                        cf = zhishu.split("~");
 
                    var zzt=Number(cf[13]);
                    console.log("涨停"+zzt)
                    for(var aa=1;aa<11;aa++){
                             zzt=(zzt*1.1).toFixed(2);
                             nr=aa+"板:"+zzt;
                             obj1.add(new Option(nr,aa));                        
                    }

                          //dzh=((Number(cf[13])-dd)/dd*100).toFixed(2);
                              console.log(dzh) 
                                  console.log(zzh) 
                         jrsj=timeFormat(new Date());
                           
                      if(pz==0){  
                      date=new Date();
                      h=date.getHours();
                      console.log(qgg)    
                      console.log(cf[13])
                      ggzs=(Number(cf[13])-qgg)/qgg*100;
                      dpzs=(Number(cf[3])-qzs)/qzs*100;
                      console.log("实时指数涨幅:"+dpzs)
                      console.log("实时个股涨幅:"+ggzs)
                      zz=(ggzs-dpzs).toFixed(2);
                      yidongjia=(((0.2-(ggzs-dpzs)/100)+(ggzs/100)+1)*result[0].hq[2][2]);
                      console.log("异动:"+yidongjia)
                      
                        gzs=(result[0].hq[0][2]*1.1).toFixed(2);
                        zhis=(gzs-qgg)/qgg;
                        zhis=(((zhis-0.2)+1)*qzs).toFixed(2);
                        zfb=((zhis-qzs)/qzs*100).toFixed(2)
                       
                        
                         if(zz==0.00){document.getElementById('wei').value="出了新的异动，偏离值明重新累计"}
                      else{
                    document.getElementById('wei').value="偏离值:"+zz+"【异动价:"+yidongjia+"】"+youguan;
                    if(zhis>0){
                    document.getElementById('wei1').value="涨停深综不能小于:"+zhis+"【"+zfb+"%】否则就异动";
                    }
                    if(h>=15&&0>xingqi<6){
                        wz=1;
                        if(qswz<wz){wz=qswz}
                         gg1=((Number(cf[13])-result[0].hq[wz][2])/result[0].hq[wz][2]*100).toFixed(2);
                        zs1=((Number(cf[3])-res[0].hq[wz][2])/res[0].hq[wz][2]*100).toFixed(2);
                        shengyu=20-(gg1-zs1);                     
                    document.getElementById('wei1').value="明涨幅超【"+shengyu+"%】异动";
                    }
                    else{
                        if(h<=9){
                        wz=2;
                        if(qswz<wz){wz=qswz}
                         gg1=((Number(cf[13])-result[0].hq[wz][2])/result[0].hq[wz][2]*100).toFixed(2);
                        zs1=((Number(cf[3])-res[0].hq[wz][2])/res[0].hq[wz][2]*100).toFixed(2);
                        shengyu=20-(gg1-zs1);                     
                    document.getElementById('wei1').value="明涨幅超【"+shengyu+"%】异动";                            
                        }
                    }
                    if(xingqi==0||xingqi==6){
                        wz=2;
                        if(qswz<wz){wz=qswz}
                         gg1=((Number(cf[13])-result[0].hq[wz][2])/result[0].hq[wz][2]*100).toFixed(2);
                        zs1=((Number(cf[3])-res[0].hq[wz][2])/res[0].hq[wz][2]*100).toFixed(2);
                        shengyu=20-(gg1-zs1);                     
                         document.getElementById('wei1').value="明涨幅超【"+shengyu+"%】就异动（大盘涨幅未计入）";                        
                    }
                      }
              
                      }

                      var tou = document.getElementById("tou");
                      var h55 =document.createElement("h4");
                      if(jsbd!=0){
                          h55.innerHTML="10日内异动:【"+bd+"次】明天减少【"+jsbd+"次异动】"+"《"+nali+"》";
                      }
                      else{
                          h55.innerHTML="10日内异动:【"+bd+"次】"+"《"+nali+"》";
                      }
                      h55.style.color="red";
                      tou.appendChild(h55);
                      if (bd>=1){
                      var p55=document.createElement("p");
                      p55.innerHTML="10日异动起点日期:【"+dyyd+"】";
                      p55.style.color="Gray";
                      p55.style.fontSize="14px";
                      tou.appendChild(p55);
                      }  
                         
                },
               })                     
                       
                    },
                   })                    
                }else{alert("输入错误重新输入【或者刚被放出来最近三天无数据】")}},  
                
               })
               
                },  
            })
   

}

   </script>
</body>

</html>
